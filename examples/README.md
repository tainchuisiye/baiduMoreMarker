## 百度地图大批量marker覆盖物地图展示：

一开始想使用地图的聚合功能实现，使用的过程中发现，遇到两个问题，1.首次加载卡顿，2.只能支持同时约4000个点（具体与电脑环境，浏览器有关系，仅供参考）在可视范围内，性能瓶颈在改变可视区域范围重新计算聚合覆盖物，在这个过程中会把所有的点重头遍历到尾，与首次加载需要画相同的时间。



------



- **首次加载卡顿：分批量加载覆盖物，加上loading可以解决，以下是一些实践的数据；**

1. **一次性加载：**
  Marker覆盖物数:20000   总时间: 15195.4970703125ms
  Marker覆盖物数:30000   总时间: 25328.45703125ms
  Marker覆盖物数:40000   总时间: 37894.23291015625ms
  Marker覆盖物数:50000   总时间: 49191.421875ms
  Marker覆盖物数60000   总时间: 64609.864990234375ms

  打开地图未加载聚合点时界面空白（计算点同步，占资源） 

2. **按1000个分批加载：** 
  Marker覆盖物数60000   总时间: 83188.876953125ms
  首次加载不白屏，动态看到聚合点个数增加加载过程中可操作其他的dom，不阻塞，例如点击别的按钮，比其他首次加载时间更长

3. **首次1000个之后全部加载：** 
  Marker覆盖物数：60000  总时间: 55358.702880859375ms
  首次加载不白屏，但加载剩下的点过程中页面卡顿，其他的dom元素无法操作，加载所需时间最短。

- **拖动重绘问题**

  **思路一**：如果使用官方的api那只能修改重绘的源码MarkerClusterer.js ------->

  MarkerClusterer.prototype._createClusters   //创建聚合覆盖物 

  ```
  cutBoundsInRange
  ```

  首次可视范围包含所有覆盖物，缩放判断等级，当等级合适时（根据一个区域内包含最多覆盖物）进行覆盖物的重绘，不建议改第三方源码。

  **思路二**：先把所有数据按某个区域划分（行政区）并计算总数，如省份，如数据颗粒大还可以往小的范围划分比如按市级逐一向下，直到满足需求，首次加载所有，通过自定义覆盖物显示区域总数，每次改变可视范围都进行判断可视区域中包含哪些行政区，这种情况，无论是否使用聚合，应该能够解决大批量覆盖物的情况，以下是目前百度官方没有api获取的数据，以及需要解决的问题：

  1.划分区域的中心点（用于放置区域里总数） （已获取省份）；

  2.划分区域的边界值  （已获取省份）；

  3.可视范围中判断包含哪些行政区规则；

  4.需要原始数据中带划分区域的标识；

  